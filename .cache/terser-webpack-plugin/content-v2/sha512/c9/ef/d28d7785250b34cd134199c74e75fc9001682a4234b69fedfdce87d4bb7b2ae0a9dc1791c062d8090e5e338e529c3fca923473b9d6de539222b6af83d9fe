{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{411:function(e,t,n){\"use strict\";n.r(t);var a=n(1),o=n(0),r=n.n(o),i=n(50),l=n(164),s=n(52),c=n(51),m=n(153),d=n(167),u=n(160),p=n(272),g=n(156);t.default=()=>{const[e,t]=Object(o.useState)(!1),[n,a]=Object(o.useState)(!1),s=i.a.useStoreState((e=>e.server.data.uuid)),c=i.a.useStoreState((e=>e.status.value)),{clearFlashes:y,clearAndAddHttpError:w}=Object(m.a)(),{connected:O,instance:v}=i.a.useStoreState((e=>e.socket));Object(o.useEffect)((()=>{if(!O||!v||\"running\"===c)return;const e=[\"(gsl token expired)\",\"(account not found)\"],n=n=>{e.some((e=>n.toLowerCase().includes(e)))&&t(!0)};return v.addListener(d.a.CONSOLE_OUTPUT,n),()=>{v.removeListener(d.a.CONSOLE_OUTPUT,n)}}),[O,v,c]);return Object(o.useEffect)((()=>{y(\"feature:gslToken\")}),[]),r.a.createElement(g.c,{onSubmit:e=>{a(!0),y(\"feature:gslToken\"),Object(p.a)(s,\"STEAM_ACC\",e.gslToken).then((()=>{v&&v.send(d.b.SET_STATE,\"restart\"),a(!1),t(!1)})).catch((e=>{console.error(e),w({key:\"feature:gslToken\",error:e})})).then((()=>a(!1)))},initialValues:{gslToken:\"\"}},r.a.createElement(l.b,{visible:e,onDismissed:()=>t(!1),closeOnBackground:!1,showSpinnerOverlay:n},r.a.createElement(k,{key:\"feature:gslToken\"}),r.a.createElement(g.b,null,r.a.createElement(S,null,\"Invalid GSL token!\"),r.a.createElement(T,null,\"It seems like your Gameserver Login Token (GSL token) is invalid or has expired.\"),r.a.createElement(f,null,\"You can either generate a new one and enter it below or leave the field blank to remove it completely.\"),r.a.createElement(h,null,r.a.createElement(u.a,{name:\"gslToken\",label:\"GSL Token\",description:\"Visit https://steamcommunity.com/dev/managegameservers to generate a token.\",autoFocus:!0})),r.a.createElement(_,null,r.a.createElement(b,{type:\"submit\"},\"Update GSL Token\")))))};var k=Object(a.c)(c.a).withConfig({displayName:\"GSLTokenModalFeature___StyledFlashMessageRender\",componentId:\"sc-1r409kx-0\"})({marginBottom:\"1rem\"}),S=Object(a.c)(\"h2\").withConfig({displayName:\"GSLTokenModalFeature___StyledH\",componentId:\"sc-1r409kx-1\"})({fontSize:\"1.5rem\",lineHeight:\"2rem\",marginBottom:\"1rem\",color:\"var(--light-color)\"}),T=Object(a.c)(\"p\").withConfig({displayName:\"GSLTokenModalFeature___StyledP\",componentId:\"sc-1r409kx-2\"})({marginTop:\"1rem\"}),f=Object(a.c)(\"p\").withConfig({displayName:\"GSLTokenModalFeature___StyledP2\",componentId:\"sc-1r409kx-3\"})({marginTop:\"1rem\"}),h=Object(a.c)(\"div\").withConfig({displayName:\"GSLTokenModalFeature___StyledDiv\",componentId:\"sc-1r409kx-4\"})({alignItems:\"center\",marginTop:\"1rem\",\"@media (min-width: 640px)\":{display:\"flex\"}}),_=Object(a.c)(\"div\").withConfig({displayName:\"GSLTokenModalFeature___StyledDiv2\",componentId:\"sc-1r409kx-5\"})({marginTop:\"2rem\",alignItems:\"center\",justifyContent:\"flex-end\",\"@media (min-width: 640px)\":{display:\"flex\"}}),b=Object(a.c)(s.a).withConfig({displayName:\"GSLTokenModalFeature___StyledButton\",componentId:\"sc-1r409kx-6\"})({marginTop:\"1rem\",width:\"100%\",\"@media (min-width: 640px)\":{marginTop:\"0px\",marginLeft:\"1rem\",width:\"auto\"}})}}]);","name":"10.f94edf8b.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[10],{\n\n/***/ 411:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var styled_components__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(1);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(0);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _state_server__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(50);\n/* harmony import */ var _components_elements_Modal__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(164);\n/* harmony import */ var _components_elements_Button__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(52);\n/* harmony import */ var _components_FlashMessageRender__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(51);\n/* harmony import */ var _plugins_useFlash__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(153);\n/* harmony import */ var _components_server_events__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(167);\n/* harmony import */ var _components_elements_Field__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(160);\n/* harmony import */ var _api_server_updateStartupVariable__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(272);\n/* harmony import */ var formik__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(156);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst GSLTokenModalFeature = () => {\n  const [visible, setVisible] = Object(react__WEBPACK_IMPORTED_MODULE_1__[\"useState\"])(false);\n  const [loading, setLoading] = Object(react__WEBPACK_IMPORTED_MODULE_1__[\"useState\"])(false);\n  const uuid = _state_server__WEBPACK_IMPORTED_MODULE_2__[/* ServerContext */ \"a\"].useStoreState(state => state.server.data.uuid);\n  const status = _state_server__WEBPACK_IMPORTED_MODULE_2__[/* ServerContext */ \"a\"].useStoreState(state => state.status.value);\n  const {\n    clearFlashes,\n    clearAndAddHttpError\n  } = Object(_plugins_useFlash__WEBPACK_IMPORTED_MODULE_6__[/* default */ \"a\"])();\n  const {\n    connected,\n    instance\n  } = _state_server__WEBPACK_IMPORTED_MODULE_2__[/* ServerContext */ \"a\"].useStoreState(state => state.socket);\n  Object(react__WEBPACK_IMPORTED_MODULE_1__[\"useEffect\"])(() => {\n    if (!connected || !instance || status === 'running') return;\n    const errors = ['(gsl token expired)', '(account not found)'];\n\n    const listener = line => {\n      if (errors.some(p => line.toLowerCase().includes(p))) {\n        setVisible(true);\n      }\n    };\n\n    instance.addListener(_components_server_events__WEBPACK_IMPORTED_MODULE_7__[/* SocketEvent */ \"a\"].CONSOLE_OUTPUT, listener);\n    return () => {\n      instance.removeListener(_components_server_events__WEBPACK_IMPORTED_MODULE_7__[/* SocketEvent */ \"a\"].CONSOLE_OUTPUT, listener);\n    };\n  }, [connected, instance, status]);\n\n  const updateGSLToken = values => {\n    setLoading(true);\n    clearFlashes('feature:gslToken');\n    Object(_api_server_updateStartupVariable__WEBPACK_IMPORTED_MODULE_9__[/* default */ \"a\"])(uuid, 'STEAM_ACC', values.gslToken).then(() => {\n      if (instance) {\n        instance.send(_components_server_events__WEBPACK_IMPORTED_MODULE_7__[/* SocketRequest */ \"b\"].SET_STATE, 'restart');\n      }\n\n      setLoading(false);\n      setVisible(false);\n    }).catch(error => {\n      console.error(error);\n      clearAndAddHttpError({\n        key: 'feature:gslToken',\n        error\n      });\n    }).then(() => setLoading(false));\n  };\n\n  Object(react__WEBPACK_IMPORTED_MODULE_1__[\"useEffect\"])(() => {\n    clearFlashes('feature:gslToken');\n  }, []);\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(formik__WEBPACK_IMPORTED_MODULE_10__[/* Formik */ \"c\"], {\n    onSubmit: updateGSLToken,\n    initialValues: {\n      gslToken: ''\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_components_elements_Modal__WEBPACK_IMPORTED_MODULE_3__[/* default */ \"b\"], {\n    visible: visible,\n    onDismissed: () => setVisible(false),\n    closeOnBackground: false,\n    showSpinnerOverlay: loading\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_StyledFlashMessageRender, {\n    key: 'feature:gslToken'\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(formik__WEBPACK_IMPORTED_MODULE_10__[/* Form */ \"b\"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_StyledH, null, \"Invalid GSL token!\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_StyledP, null, \"It seems like your Gameserver Login Token (GSL token) is invalid or has expired.\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_StyledP2, null, \"You can either generate a new one and enter it below or leave the field blank to remove it completely.\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_StyledDiv, null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_components_elements_Field__WEBPACK_IMPORTED_MODULE_8__[/* default */ \"a\"], {\n    name: 'gslToken',\n    label: 'GSL Token',\n    description: 'Visit https://steamcommunity.com/dev/managegameservers to generate a token.',\n    autoFocus: true\n  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_StyledDiv2, null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_StyledButton, {\n    type: 'submit'\n  }, \"Update GSL Token\")))));\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (GSLTokenModalFeature);\n\nvar _StyledFlashMessageRender = Object(styled_components__WEBPACK_IMPORTED_MODULE_0__[/* default */ \"c\"])(_components_FlashMessageRender__WEBPACK_IMPORTED_MODULE_5__[/* default */ \"a\"]).withConfig({\n  displayName: \"GSLTokenModalFeature___StyledFlashMessageRender\",\n  componentId: \"sc-1r409kx-0\"\n})({\n  \"marginBottom\": \"1rem\"\n});\n\nvar _StyledH = Object(styled_components__WEBPACK_IMPORTED_MODULE_0__[/* default */ \"c\"])(\"h2\").withConfig({\n  displayName: \"GSLTokenModalFeature___StyledH\",\n  componentId: \"sc-1r409kx-1\"\n})({\n  \"fontSize\": \"1.5rem\",\n  \"lineHeight\": \"2rem\",\n  \"marginBottom\": \"1rem\",\n  \"color\": \"var(--light-color)\"\n});\n\nvar _StyledP = Object(styled_components__WEBPACK_IMPORTED_MODULE_0__[/* default */ \"c\"])(\"p\").withConfig({\n  displayName: \"GSLTokenModalFeature___StyledP\",\n  componentId: \"sc-1r409kx-2\"\n})({\n  \"marginTop\": \"1rem\"\n});\n\nvar _StyledP2 = Object(styled_components__WEBPACK_IMPORTED_MODULE_0__[/* default */ \"c\"])(\"p\").withConfig({\n  displayName: \"GSLTokenModalFeature___StyledP2\",\n  componentId: \"sc-1r409kx-3\"\n})({\n  \"marginTop\": \"1rem\"\n});\n\nvar _StyledDiv = Object(styled_components__WEBPACK_IMPORTED_MODULE_0__[/* default */ \"c\"])(\"div\").withConfig({\n  displayName: \"GSLTokenModalFeature___StyledDiv\",\n  componentId: \"sc-1r409kx-4\"\n})({\n  \"alignItems\": \"center\",\n  \"marginTop\": \"1rem\",\n  \"@media (min-width: 640px)\": {\n    \"display\": \"flex\"\n  }\n});\n\nvar _StyledDiv2 = Object(styled_components__WEBPACK_IMPORTED_MODULE_0__[/* default */ \"c\"])(\"div\").withConfig({\n  displayName: \"GSLTokenModalFeature___StyledDiv2\",\n  componentId: \"sc-1r409kx-5\"\n})({\n  \"marginTop\": \"2rem\",\n  \"alignItems\": \"center\",\n  \"justifyContent\": \"flex-end\",\n  \"@media (min-width: 640px)\": {\n    \"display\": \"flex\"\n  }\n});\n\nvar _StyledButton = Object(styled_components__WEBPACK_IMPORTED_MODULE_0__[/* default */ \"c\"])(_components_elements_Button__WEBPACK_IMPORTED_MODULE_4__[/* default */ \"a\"]).withConfig({\n  displayName: \"GSLTokenModalFeature___StyledButton\",\n  componentId: \"sc-1r409kx-6\"\n})({\n  \"marginTop\": \"1rem\",\n  \"width\": \"100%\",\n  \"@media (min-width: 640px)\": {\n    \"marginTop\": \"0px\",\n    \"marginLeft\": \"1rem\",\n    \"width\": \"auto\"\n  }\n});\n\n/***/ })\n\n}]);","inputSourceMap":null}